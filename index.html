<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generic CSV to MySQL JSON Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        h1 {
            color: #2d3748;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.7);
        }
        .section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #4a5568;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        textarea {
            min-height: 200px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            resize: vertical;
        }
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .control-group label {
            margin-bottom: 5px;
        }
        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .btn-secondary {
            background: linear-gradient(45deg, #48bb78, #38a169);
            margin-left: 10px;
        }
        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(72, 187, 120, 0.3);
        }
        .field-mapping {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e2e8f0;
        }
        .field-row {
            display: grid;
            grid-template-columns: 2fr 2fr 1fr 1fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
        }
        .field-row:last-child {
            margin-bottom: 0;
        }
        .field-header {
            font-weight: bold;
            background: #667eea;
            color: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .remove-btn {
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
        }
        .remove-btn:hover {
            background: #c53030;
        }
        .add-field-btn {
            background: #48bb78;
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 14px;
        }
        .newline-options {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .newline-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .newline-option input[type="radio"] {
            margin: 0;
        }
        .error {
            color: #e53e3e;
            background: #fed7d7;
            border: 1px solid #feb2b2;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .success {
            color: #2f855a;
            background: #c6f6d5;
            border: 1px solid #9ae6b4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        .stats {
            background: linear-gradient(45deg, #e6fffa, #b2f5ea);
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
        }
        .preview-section {
            background: #1a202c;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .csv-headers {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 2px solid #cbd5e0;
        }
        .csv-headers h3 {
            margin: 0 0 10px 0;
            color: #2d3748;
        }
        .headers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .header-tag {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Generic CSV to MySQL JSON Converter</h1>
        
        <!-- Step 1: CSV Input -->
        <div class="section">
            <h2>üìä Step 1: Paste Your CSV Data</h2>
            <label for="csvInput">CSV Data:</label>
            <textarea id="csvInput" placeholder="Paste your CSV data here..."></textarea>
            <button onclick="analyzeCsv()" style="margin-top: 10px;">üîç Analyze CSV Structure</button>
        </div>

        <!-- CSV Headers Display -->
        <div id="csvHeadersSection" class="csv-headers" style="display: none;">
            <h3>üìã Detected CSV Headers:</h3>
            <div id="headersList" class="headers-list"></div>
        </div>
        
        <!-- Step 2: Database Configuration -->
        <div class="section">
            <h2>üóÑÔ∏è Step 2: Database Configuration</h2>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="tableName">Table Name:</label>
                    <input type="text" id="tableName" value="countries" placeholder="e.g., users, products, countries">
                </div>
                <div class="control-group">
                    <label for="idColumn">ID Column Name:</label>
                    <input type="text" id="idColumn" value="id" placeholder="e.g., id, user_id, product_id">
                </div>
                <div class="control-group">
                    <label for="jsonColumn">JSON Column Name:</label>
                    <input type="text" id="jsonColumn" value="body" placeholder="e.g., body, data, object_info">
                </div>
                <div class="control-group">
                    <label for="idSourceColumn">ID Source CSV Column:</label>
                    <select id="idSourceColumn">
                        <option value="id">id</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Step 3: Field Mapping -->
        <div class="section">
            <h2>üîó Step 3: Field Mapping (CSV ‚Üí JSON)</h2>
            <div class="field-mapping">
                <div class="field-row">
                    <div class="field-header">CSV Column</div>
                    <div class="field-header">JSON Key</div>
                    <div class="field-header">Data Type</div>
                    <div class="field-header">Parse as JSON</div>
                    <div class="field-header">Action</div>
                </div>
                <div id="fieldMappings"></div>
                <button class="add-field-btn" onclick="addFieldMapping()">‚ûï Add Field Mapping</button>
                <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; font-size: 14px;">
                    üí° <strong>Tip:</strong> Click "Analyze CSV Structure" first to populate the CSV column dropdowns automatically.
                </div>
            </div>
        </div>
        
        <!-- Step 4: Options -->
        <div class="section">
            <h2>‚öôÔ∏è Step 4: Conversion Options</h2>
            <div class="control-group">
                <label>Newline Handling in Text Fields:</label>
                <div class="newline-options">
                    <div class="newline-option">
                        <input type="radio" id="escape" name="newlineFormat" value="escape" checked>
                        <label for="escape">Escape as \n</label>
                    </div>
                    <div class="newline-option">
                        <input type="radio" id="br" name="newlineFormat" value="br">
                        <label for="br">Convert to &lt;br&gt;</label>
                    </div>
                    <div class="newline-option">
                        <input type="radio" id="array" name="newlineFormat" value="array">
                        <label for="array">Split into array</label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Convert Button -->
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="convertData()" style="font-size: 18px; padding: 16px 32px;">
                üîÑ Convert to MySQL
            </button>
            <button class="btn-secondary" onclick="previewJson()" style="font-size: 18px; padding: 16px 32px;">
                üëÅÔ∏è Preview JSON
            </button>
        </div>
        
        <div id="messages"></div>
        
        <!-- Step 5: Output -->
        <div class="section">
            <h2>üì§ Generated MySQL INSERT Statements</h2>
            <textarea id="sqlOutput" class="result" readonly style="background: #1a202c; color: #e2e8f0;"></textarea>
            <button class="btn-secondary" onclick="copyToClipboard()" style="margin-top: 10px;">üìã Copy to Clipboard</button>
        </div>
    </div>

    <script>
        let csvHeaders = [];
        let csvData = [];

        function analyzeCsv() {
            const csvInput = document.getElementById('csvInput').value.trim();
            const messages = document.getElementById('messages');
            
            if (!csvInput) {
                showMessage('Please paste your CSV data first.', 'error');
                return;
            }
            
            try {
                const results = Papa.parse(csvInput, {
                    header: true,
                    skipEmptyLines: true,
                    dynamicTyping: false,
                    trimHeaders: true
                });
                
                if (results.errors.length > 0) {
                    showMessage('CSV parsing errors: ' + results.errors.map(e => e.message).join(', '), 'error');
                    return;
                }
                
                csvData = results.data;
                csvHeaders = results.meta.fields || [];
                
                if (csvHeaders.length === 0) {
                    showMessage('No headers detected in CSV.', 'error');
                    return;
                }
                
                // Display headers
                displayCsvHeaders();
                
                // Update ID source dropdown
                updateIdSourceDropdown();
                
                // Auto-add some common field mappings
                autoGenerateFieldMappings();
                
                showMessage(`CSV analyzed successfully! Found ${csvHeaders.length} columns and ${csvData.length} rows.`, 'success');
                
            } catch (error) {
                showMessage('Error analyzing CSV: ' + error.message, 'error');
                console.error('Error:', error);
            }
        }
        
        function displayCsvHeaders() {
            const headersSection = document.getElementById('csvHeadersSection');
            const headersList = document.getElementById('headersList');
            
            headersList.innerHTML = csvHeaders.map(header => 
                `<span class="header-tag">${header}</span>`
            ).join('');
            
            headersSection.style.display = 'block';
        }
        
        function updateIdSourceDropdown() {
            const idSourceSelect = document.getElementById('idSourceColumn');
            idSourceSelect.innerHTML = csvHeaders.map(header => 
                `<option value="${header}" ${header.toLowerCase().includes('id') ? 'selected' : ''}>${header}</option>`
            ).join('');
        }
        
        function autoGenerateFieldMappings() {
            const fieldMappings = document.getElementById('fieldMappings');
            fieldMappings.innerHTML = '';
            
            // Only generate if we have headers
            if (!csvHeaders || csvHeaders.length === 0) {
                return;
            }
            
            // Add common mappings based on column names
            csvHeaders.forEach(header => {
                if (!header.toLowerCase().includes('create') && 
                    !header.toLowerCase().includes('write') && 
                    !header.toLowerCase().includes('uid') &&
                    header !== 'id') {
                    addFieldMapping(header, camelCase(header), detectDataType(header));
                }
            });
        }
        
        function camelCase(str) {
            return str.replace(/_([a-z])/g, (match, letter) => letter.toUpperCase())
                     .replace(/^([a-z])/, (match, letter) => letter.toLowerCase());
        }
        
        function detectDataType(header) {
            const lowerHeader = header.toLowerCase();
            if (lowerHeader.includes('required') || lowerHeader.includes('active') || lowerHeader.includes('enabled')) {
                return 'boolean';
            } else if (lowerHeader.includes('id') || lowerHeader.includes('code') || lowerHeader.includes('phone')) {
                return 'number';
            } else if (lowerHeader.includes('name') && lowerHeader.includes('{')) {
                return 'string';
            }
            return 'string';
        }
        
        function addFieldMapping(csvColumn = '', jsonKey = '', dataType = 'string', parseJson = false) {
            const fieldMappings = document.getElementById('fieldMappings');
            const fieldId = 'field_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Create options for CSV columns
            let csvOptions = '<option value="">-- Select CSV Column --</option>';
            if (csvHeaders && csvHeaders.length > 0) {
                csvOptions += csvHeaders.map(header => 
                    `<option value="${header}" ${header === csvColumn ? 'selected' : ''}>${header}</option>`
                ).join('');
            } else {
                csvOptions += '<option value="" disabled>Please analyze CSV first</option>';
            }
            
            const fieldRow = document.createElement('div');
            fieldRow.className = 'field-row';
            fieldRow.innerHTML = `
                <select name="csvColumn" onchange="updateJsonKey(this)">
                    ${csvOptions}
                </select>
                <input type="text" name="jsonKey" value="${jsonKey}" placeholder="e.g., userId, productName">
                <select name="dataType">
                    <option value="string" ${dataType === 'string' ? 'selected' : ''}>String</option>
                    <option value="number" ${dataType === 'number' ? 'selected' : ''}>Number</option>
                    <option value="boolean" ${dataType === 'boolean' ? 'selected' : ''}>Boolean</option>
                    <option value="array" ${dataType === 'array' ? 'selected' : ''}>Array</option>
                </select>
                <input type="checkbox" name="parseJson" ${parseJson ? 'checked' : ''} title="Parse this field as JSON">
                <button type="button" class="remove-btn" onclick="removeFieldMapping(this)">‚ùå</button>
            `;
            
            fieldMappings.appendChild(fieldRow);
        }
        
        function updateJsonKey(selectElement) {
            const fieldRow = selectElement.closest('.field-row');
            const jsonKeyInput = fieldRow.querySelector('input[name="jsonKey"]');
            const selectedColumn = selectElement.value;
            
            if (selectedColumn && !jsonKeyInput.value) {
                jsonKeyInput.value = camelCase(selectedColumn);
            }
        }
        
        function removeFieldMapping(button) {
            button.closest('.field-row').remove();
        }
        
        function getFieldMappings() {
            const fieldRows = document.querySelectorAll('#fieldMappings .field-row');
            const mappings = [];
            
            fieldRows.forEach(row => {
                const csvColumn = row.querySelector('select[name="csvColumn"]').value;
                const jsonKey = row.querySelector('input[name="jsonKey"]').value;
                const dataType = row.querySelector('select[name="dataType"]').value;
                const parseJson = row.querySelector('input[name="parseJson"]').checked;
                
                if (csvColumn && jsonKey) {
                    mappings.push({ csvColumn, jsonKey, dataType, parseJson });
                }
            });
            
            return mappings;
        }
        
        function previewJson() {
            if (csvData.length === 0) {
                showMessage('Please analyze CSV data first.', 'error');
                return;
            }
            
            const mappings = getFieldMappings();
            if (mappings.length === 0) {
                showMessage('Please add at least one field mapping.', 'error');
                return;
            }
            
            try {
                const sampleRow = csvData[0];
                const jsonObj = processRowToJson(sampleRow, mappings);
                const previewJson = JSON.stringify(jsonObj, null, 2);
                
                showMessage(`Preview of first row JSON:\n\n${previewJson}`, 'success');
                
            } catch (error) {
                showMessage('Error generating preview: ' + error.message, 'error');
            }
        }
        
        function convertData() {
            if (csvData.length === 0) {
                showMessage('Please analyze CSV data first.', 'error');
                return;
            }
            
            const mappings = getFieldMappings();
            if (mappings.length === 0) {
                showMessage('Please add at least one field mapping.', 'error');
                return;
            }
            
            const tableName = document.getElementById('tableName').value.trim();
            const idColumn = document.getElementById('idColumn').value.trim();
            const jsonColumn = document.getElementById('jsonColumn').value.trim();
            const idSourceColumn = document.getElementById('idSourceColumn').value;
            
            if (!tableName || !idColumn || !jsonColumn) {
                showMessage('Please fill in all database configuration fields.', 'error');
                return;
            }
            
            try {
                const sqlStatements = csvData.map(row => 
                    generateMySQLInsert(row, mappings, tableName, idColumn, jsonColumn, idSourceColumn)
                );
                
                const sqlOutput = document.getElementById('sqlOutput');
                sqlOutput.value = sqlStatements.join('\n\n');
                
                showMessage(`Successfully converted ${csvData.length} records!`, 'success');
                showStats(csvData.length, mappings.length);
                
            } catch (error) {
                showMessage('Error converting data: ' + error.message, 'error');
                console.error('Error:', error);
            }
        }
        
        function processRowToJson(row, mappings) {
            const jsonObj = {};
            const newlineFormat = document.querySelector('input[name="newlineFormat"]:checked').value;
            
            mappings.forEach(mapping => {
                const { csvColumn, jsonKey, dataType, parseJson } = mapping;
                let value = row[csvColumn];
                
                // Handle null/undefined values
                if (value === undefined || value === null || value === 'NULL' || value === '') {
                    jsonObj[jsonKey] = null;
                    return;
                }
                
                // Parse JSON if requested
                if (parseJson && typeof value === 'string') {
                    try {
                        value = JSON.parse(value.replace(/'/g, '"'));
                    } catch (e) {
                        // If parsing fails, keep as string
                    }
                }
                
                // Process based on data type
                switch (dataType) {
                    case 'number':
                        jsonObj[jsonKey] = value === 'NULL' ? null : (parseFloat(value) || 0);
                        break;
                        
                    case 'boolean':
                        jsonObj[jsonKey] = value === 'True' || value === 'true' || value === '1';
                        break;
                        
                    case 'array':
                        if (typeof value === 'string') {
                            jsonObj[jsonKey] = value.split(',').map(item => item.trim());
                        } else {
                            jsonObj[jsonKey] = value;
                        }
                        break;
                        
                    case 'string':
                    default:
                        if (typeof value === 'string' && value.includes('\n')) {
                            switch (newlineFormat) {
                                case 'escape':
                                    jsonObj[jsonKey] = value.replace(/\n/g, '\\n');
                                    break;
                                case 'br':
                                    jsonObj[jsonKey] = value.replace(/\n/g, '<br>');
                                    break;
                                case 'array':
                                    jsonObj[jsonKey] = value.split('\n');
                                    break;
                                default:
                                    jsonObj[jsonKey] = value;
                            }
                        } else {
                            jsonObj[jsonKey] = value;
                        }
                        break;
                }
            });
            
            return jsonObj;
        }
        
        function generateMySQLInsert(row, mappings, tableName, idColumn, jsonColumn, idSourceColumn) {
            const idValue = row[idSourceColumn] || 'NULL';
            const jsonObj = processRowToJson(row, mappings);
            
            const jsonString = JSON.stringify(jsonObj, null, 2);
            const escapedJson = jsonString.replace(/'/g, "\\'");
            
            return `INSERT INTO ${tableName} (${idColumn}, ${jsonColumn}) VALUES (${idValue}, '${escapedJson}');`;
        }
        
        function showMessage(message, type) {
            const messages = document.getElementById('messages');
            messages.innerHTML = `<div class="${type}">${message.replace(/\n/g, '<br>')}</div>`;
            
            if (type === 'success') {
                setTimeout(() => {
                    if (messages.innerHTML.includes(message.split('\n')[0])) {
                        messages.innerHTML = '';
                    }
                }, 8000);
            }
        }
        
        function showStats(recordCount, fieldCount) {
            const messages = document.getElementById('messages');
            const statsDiv = document.createElement('div');
            statsDiv.className = 'stats';
            statsDiv.innerHTML = `
                <strong>üéâ Conversion Statistics:</strong><br>
                ‚Ä¢ Records processed: <strong>${recordCount}</strong><br>
                ‚Ä¢ Fields mapped: <strong>${fieldCount}</strong><br>
                ‚Ä¢ Table: <strong>${document.getElementById('tableName').value}</strong><br>
                ‚Ä¢ Newline format: <strong>${document.querySelector('input[name="newlineFormat"]:checked').nextElementSibling.textContent}</strong><br>
                ‚Ä¢ Ready to execute in MySQL! üöÄ
            `;
            messages.appendChild(statsDiv);
        }
        
        function copyToClipboard() {
            const sqlOutput = document.getElementById('sqlOutput');
            sqlOutput.select();
            sqlOutput.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showMessage('‚úÖ SQL statements copied to clipboard!', 'success');
            } catch (err) {
                showMessage('‚ùå Failed to copy to clipboard. Please select and copy manually.', 'error');
            }
        }
        
        // Initialize with sample data
window.onload = function() {
    const sampleCSV = `"student_id","first_name","last_name","class","section","roll_no","marks","grade","dob"
1,"Alice","Johnson","Mathematics","A",12,88,"B+","2006-05-12"
2,"Brian","Smith","Science","B",7,92,"A","2005-11-23"
3,"Catherine","Lee","History","A",18,76,"C+","2006-02-08"
4,"David","Wong","English","C",3,85,"B","2005-07-19"
5,"Emma","Brown","Mathematics","B",15,95,"A+","2006-09-30"`;

    document.getElementById('csvInput').value = sampleCSV;

        };
    </script>
</body>
</html>
